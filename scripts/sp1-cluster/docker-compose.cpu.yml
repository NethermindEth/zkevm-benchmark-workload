# CPU Worker override - use with: docker compose -f docker-compose.yml -f docker-compose.cpu.yml up
services:
  sp1-cpu-worker:
    image: ${SP1_CLUSTER_IMAGE:-ghcr.io/succinctlabs/sp1-cluster:base-v1.0.4}
    command: ["/node"]
    environment:
      NODE_COORDINATOR_RPC: http://sp1-coordinator:50052
      WORKER_MAX_WEIGHT_OVERRIDE: ${CPU_WORKER_MAX_WEIGHT:-32}
      NODE_ARTIFACT_STORE: redis
      NODE_REDIS_NODES: redis://:${REDIS_PASSWORD:-}@redis:6379/0
      WORKER_TYPE: CPU
      RUST_LOG: ${RUST_LOG:-info}
      # CPU worker thread configuration
      RAYON_NUM_THREADS: ${CPU_THREADS:-0}
    volumes:
      - ${HOME}/.sp1/circuits:/root/.sp1/circuits
    depends_on:
      - sp1-coordinator
      - redis
    networks:
      - sp1-network
    restart: unless-stopped
    deploy:
      resources:
        limits:
          cpus: '8'
          memory: ${CPU_WORKER_MEMORY:-32G}
        reservations:
          cpus: '4'
          memory: ${CPU_WORKER_MEMORY:-32G}

